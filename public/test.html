<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <form id="upload">
        <input type="file" name="file" id="photo">
        <button type="submit">Upload Photo</button>
    </form>
    <script src="https://code.jquery.com/jquery.js"></script>
    <script>
        $("#upload").on("submit", event => {
            event.preventDefault();
            // var file = $("#photo")[0].files[0];
            // console.log(file);
            var files = $('#photo')[0].files;
            var fd = new FormData();
        console.log(files)
        // Check file selected or not
        fd.append('file', $('input[type=file]')[0].files[0]);
            console.log(fd);
            // const image = $("#photo").val();
            // console.log(image);
            $.ajax({
                url: "/upload",
                type: "POST",
                data: fd,
                enctype: "multipart/form-data",
                processData: false,
                contentType: false,
            }).then(data => {
                console.log("Success");
            })
        });


        app.get("/cart/:userid", (req, res) => {
        db.Cart.findAll({
            where: {
                UserId: req.params.userid
            },
            include: {
                all: true
            }
        }).then(result => {
            let toSend = {
                userid: req.params.userid
            };
            if (result.length > 0) {
                toSend.hasItems = true;
                let data = [];
                result.forEach(item => {
                    let cart = {
                        cartid: item.id,
                        productid: item.ProductId,
                        quantity: item.quantity,
                        image: item.Product.image,
                        name: item.Product.name,
                        price: item.Product.price
                    };
                    cart.cost = cart.quantity * cart.price;
                    data.push(cart);
                });
                toSend.cart = data;
                let subtotal;
                if (data.length > 1) {
                    subtotal = data.reduce((a, b) => a.cost + b.cost).toFixed(2);
                } else {
                    subtotal = data[0].cost;
                };
                toSend.subtotal = subtotal;
            } else {
                toSend.hasItems = false;
                toSend.subtotal = 0.00;
            };
            res.render("cart", toSend);
        });
    });

    </script>
</body>
</html>